<ng-template #popTemplate>
  <div *ngIf="popoverNotes" class="popover-details">
    <strong>{{popoverAmount | currency}}</strong> was originally submitted.
    <div>
      <strong>Approver Notes:&nbsp;</strong><span [innerHTML]="popoverNotes"></span>
    </div>
  </div>
</ng-template>
<div class="line-items full-width pb-1 px-1">
  <div class="m-0">
    <div *ngIf="itemList.items" class="pt-1 full-width">
      <div class="full-width align-items-center row">
        <div class="align-items-center column">
          <h4 class="mt-0 pr-1">{{ itemTypeDisplay }}</h4>
          <h5
            *ngIf="
              itemType === 'equipmentActive' ||
              itemType === 'equipmentRental' ||
              itemType === 'equipmentStandby'
            "
            class="no-top-margin"
          >
            Location: {{ adjustments.rentalLocation.stateCode }} | Ownership:
            {{ adjustments.equipmentActive.ownership | percent }}
            | Operating: {{ adjustments.equipmentActive.operating | percent }}
          </h5>
          <h5
            *ngIf="
              !accountSynced &&
              (itemType === 'equipmentActive' ||
                itemType === 'equipmentStandby' ||
                itemType === 'equipmentRental')
            "
          >
            Log in with your EQW credentials to access
          </h5>
          <div class="ml-0 row align-items-center">
            <div *ngIf="!editMode" class="align-items-center">
              <button
                *ngIf="hasPending && manageRequests"
                [disabled]="!manageRequests || !accountSynced"
                type="button"
                class="btn btn-sm
                btn-outline-primary"
                (click)="approveAll()"
              >
                <clr-icon shape="check"></clr-icon>Approve All
              </button>
              <button
                *ngIf="
                  submitRequests &&
                  (itemType === 'equipmentActive' ||
                    itemType === 'equipmentStandby' ||
                    itemType === 'equipmentRental')
                "
                [disabled]="!submitRequests || !accountSynced"
                type="button"
                class="btn btn-sm
                btn-outline-primary"
                (click)="addFromSaved()"
              >
                Add From Saved Models
              </button>
              <button
                *ngIf="
                  submitRequests &&
                  (itemType === 'equipmentActive' ||
                    itemType === 'equipmentStandby' ||
                    itemType === 'equipmentRental')
                "
                [disabled]="!submitRequests || !accountSynced"
                type="button"
                class="btn btn-sm
                btn-outline-primary"
                (click)="addModel()"
              >
                Add New Model
              </button>
              <button
                *ngIf="
                  submitRequests &&
                  (itemType === 'equipmentActive' ||
                    itemType === 'equipmentStandby' ||
                    itemType === 'equipmentRental')
                "
                [disabled]="!submitRequests || !accountSynced"
                type="button"
                class="btn btn-sm
                btn-outline-primary"
                (click)="addMiscEquipment()"
              >
                Add New Miscellaneous Model
              </button>
              <button
                *ngIf="
                  submitRequests &&
                  (itemType !== 'equipmentActive' &&
                    itemType !== 'equipmentStandby' &&
                    itemType !== 'equipmentRental' &&
                    itemType !== 'labor')
                "
                [disabled]="!submitRequests"
                type="button"
                class="btn btn-sm
                btn-outline-primary"
                (click)="addLineItems()"
              >
                Add Line Item
              </button>
              <button
                *ngIf="submitRequests && itemType === 'labor'"
                [disabled]="!submitRequests"
                type="button"
                class="btn btn-sm
                btn-outline-primary"
                (click)="addFromSaved()"
              >
                Add From Saved Employees
              </button>
              <button
                *ngIf="submitRequests && itemType === 'labor'"
                [disabled]="!submitRequests"
                type="button"
                class="btn btn-sm
                btn-outline-primary"
                (click)="addLineItems()"
              >
                Add New Employee
              </button>
            </div>
          </div>
        </div>
        <div *ngIf="manageRequests || manageProject" class="spacer"></div>

        <div
          *ngIf="
            (manageRequests || manageProject) &&
            accountSynced &&
            (itemType === 'equipmentActive' ||
              itemType === 'equipmentStandby' ||
              itemType === 'equipmentRental')
          "
          class="row align-items-center"
        >
          <h6 class="no-top-margin">powered by&nbsp;</h6>
          <img alt="logo" height="40" src="../assets/img/ew.gif" />
          <h6 class="no-top-margin big-text">&nbsp;|&nbsp;</h6>
          <div class="px-1 row align-items-center">
            <mat-icon svgIcon="costtrax-check"></mat-icon>
            <div class="column">
              <div class="small-text no-top-margin">&nbsp;Rate Verified</div>
            </div>
          </div>
          <div class="px-1 row align-items-center">
            <mat-icon class="icon" color="warn">priority_high</mat-icon>
            <div class="column">
              <div class="small-text no-top-margin">Rate Issues</div>
            </div>
          </div>
          <div class="px-1 row align-items-center">
            <mat-icon class="icon">help_outline</mat-icon>
            <div class="column">
              <div class="small-text no-top-margin">&nbsp;Missing Data</div>
            </div>
          </div>
        </div>
      </div>

      <clr-datagrid *ngIf="itemType === 'labor'">
        <clr-dg-column
          [clrDgField]="'details.employee.lastName'"
          style="width:250px"
          >Last Name</clr-dg-column
        >
        <clr-dg-column
          [clrDgField]="'details.employee.firstName'"
          style="width:250px"
          >First Name</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.class'" style="width:150px"
          >Trade / Class</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.rate'" style="width:150px"
          >Hourly Rate</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.multiplier'" style="width:155px"
          >Multiplier</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.hours'" style="width:155px"
          >Hours</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.fringe'"
          >Fringe Benefits</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'subtotal'" style="min-width:200px">Total</clr-dg-column>
        <clr-dg-column></clr-dg-column>
        <clr-dg-row
          *clrDgItems="
            let item of itemList.items;
            let i = index;
            trackBy: trackByFn
          "
          [clrDgItem]="item"
        >
          <clr-dg-cell>
            <div *ngIf="submitRequests">
              <input
                nz-input
                nzSize="small"
                class="full-width"
                (change)="laborChanged(item)"
                (keypress)="laborChanged(item)"
                [(ngModel)]="item.details.employee.lastName"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
            <div *ngIf="!submitRequests">
              {{ item.details.employee.lastName }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="submitRequests">
              <input
                nz-input
                nzSize="small"
                class="full-width"
                (change)="laborChanged(item)"
                (keypress)="laborChanged(item)"
                [(ngModel)]="item.details.employee.firstName"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
            <div *ngIf="!submitRequests">
              {{ item.details.employee.firstName }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="submitRequests">
              <input
                nz-input
                nzSize="small"
                class="full-width"
                (change)="laborChanged(item)"
                (keypress)="laborChanged(item)"
                [(ngModel)]="item.details.class"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
            <div *ngIf="!submitRequests">{{ item.details.class }}</div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="submitRequests">
              <input
                nz-input
                *ngIf="submitRequests"
                placeholder="Rate"
                nzSize="small"
                currencyMask
                (blur)="laborChanged(item)"
                style="width:100px"
                (keypress)="laborChanged(item)"
                [(ngModel)]="item.details.rate"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
            <div *ngIf="!submitRequests">
              {{ item.details.rate | currency }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="submitRequests">
              <nz-input-number
                [(ngModel)]="item.details.multiplier"
                style="width:65px"
                (ngModelChange)="laborChanged(item)"
                [nzSize]="'small'"
                [nzMin]="0"
                [nzStep]="1"
              ></nz-input-number>
            </div>
            <div *ngIf="!submitRequests">
              {{ item.details.multiplier | number: '.1-2' }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="submitRequests">
              <nz-input-number
                [(ngModel)]="item.details.hours"
                style="width:65px"
                (ngModelChange)="laborChanged(item)"
                [nzSize]="'small'"
                [nzMin]="0"
                [nzStep]="1"
              ></nz-input-number>
            </div>
            <div *ngIf="!submitRequests">
              {{ item.details.hours | number: '.1-2' }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="submitRequests">
              <input
                nz-input
                placeholder="Fringe Benefits"
                nzSize="small"
                currencyMask
                (blur)="laborChanged(item)"
                style="width:100px"
                (keypress)="laborChanged(item)"
                [(ngModel)]="item.details.fringe"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
            <div *ngIf="!submitRequests">
              {{ item.details.fringe | currency }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="row no-row-margins align-items-center" *ngIf="item.amountAdjusted">
              {{ item.subtotalApproved | currency }}
              <span class="pl-3p pt-3p pointer" [popover]="item.popover" triggers="mouseenter:mouseleave" (onShown)="onPopoverShown(item)" (onHidden)="onPopoverHidden()" outsideClick="true" containerClass="popover-content" container="body">
                <i class="material-icons md-20 md-dark">
                  info
                </i>
              </span>
            </div>
            <span class="padding-label-top" *ngIf="!item.amountAdjusted">
              {{ item.subtotal | currency }}
            </span>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="row">
              <button
                [ngClass]="{
                  'icon-button':
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0),
                  'inactive-button':
                    !submitRequests &&
                    (!item.attachments || item.attachments.length == 0),
                  ripple:
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0)
                }"
                [disabled]="
                  (manageRequests || manageProject) &&
                  (!item.attachments || item.attachments.length === 0)
                "
                [matTooltip]="
                  manageRequests ||
                  manageProject ||
                  (item.attachments && item.attachments.length > 0)
                    ? 'View
                Attachments'
                    : 'Add Attachments'
                "
                (click)="viewAttachments(item)"
              >
                <span
                  *ngIf="
                    submitRequests &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  class="badge accent-badge"
                  >+</span
                >
                <span
                  *ngIf="item.attachments && item.attachments.length > 0"
                  class="badge notify-badge"
                  >{{ item.attachments.length }}</span
                >
                <mat-icon
                  [class.disabled]="
                    (manageRequests || manageProject) &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  color="accent"
                  >attach_file</mat-icon
                >
              </button>
              <span *ngIf="submitRequests">
                <button
                  class="ripple icon-button"
                  *ngIf="submitRequests"
                  matTooltip="Remove"
                  (click)="removeLineItem(i, item)"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </span>
              <span *ngIf="manageRequests">
                <button
                  class="ripple icon-button"
                  [disabled]="!manageRequests"
                  matTooltip="Approve
                  With
                  Change"
                  (click)="approveWithChange(i, item)"
                >
                  <mat-icon
                    color="accent"
                    svgIcon="approvewedit"
                    class="approvewedit"
                  ></mat-icon>
                </button>
              </span>
            </div>
          </clr-dg-cell>
        </clr-dg-row>
        <clr-dg-footer *ngIf="!printingInvoice"
          >{{ itemList.items.length }} Items</clr-dg-footer
        >
      </clr-datagrid>
      <clr-datagrid *ngIf="itemType === 'equipmentActive' && accountSynced">
        <clr-dg-column
          *ngIf="manageRequests || manageProject"
          style="width:50px"
          >Status
        </clr-dg-column>
        <clr-dg-column
          [clrDgField]="'details.manufacturerName'"
          style="width:200px"
          >Make</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.model'" style="width:150px"
          >Model</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.year'" style="width:75px"
          >Year</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.subSize'" style="width:350px"
          >Subtype & Size Class</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.hours'" style="width:55px"
          >Hours</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.rate'" style="width:150px"
          >FHWA</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.transport'" style="width:150px"
          >Transport</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'subtotal'" style="min-width:200px"
          >Total</clr-dg-column
        >
        <clr-dg-column></clr-dg-column>
        <clr-dg-row
          class="align-items-center"
          *clrDgItems="
            let item of itemList.items;
            let i = index;
            trackBy: trackByFn
          "
          [clrDgItem]="item"
        >
          <clr-dg-cell *ngIf="manageRequests || manageProject">
            <div
              *ngIf="(manageRequests || manageProject) && item.rateVerified()"
              class="padding-label-top row pl-1"
              style="padding-left: 10px !important"
            >
              <mat-icon svgIcon="costtrax-check"></mat-icon>
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">
              {{ item.details.manufacturerName }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">{{ item.details.model }}</div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="item.misc">N/A</div>
            <div class="padding-label-top" *ngIf="!item.misc">
              {{ item.details.year }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">{{ item.details.subSize }}</div>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="padding-label-top">
              <div *ngIf="!submitRequests">
                {{ item.details.hours | number: '.0-0' }}
              </div>
              <nz-input-number
                *ngIf="submitRequests"
                [(ngModel)]="item.details.hours"
                style="width:65px"
                (ngModelChange)="activeChanged(item)"
                [nzSize]="'small'"
                [nzMin]="0"
                [nzStep]="1"
              ></nz-input-number>
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="!item.details.nodata" class="padding-label-top">
              {{ item.details.rate | currency }}
            </div>
            <div class="padding-label-top" *ngIf="item.details.nodata">
              no data
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="!submitRequests">
              {{ item.details.transport | currency }}
            </div>
            <div class="padding-label-top" *ngIf="submitRequests">
              <input
                nz-input
                placeholder="Transport"
                nzSize="small"
                currencyMask
                (blur)="activeChanged(item)"
                style="width:100px"
                (keypress)="activeChanged(item)"
                [(ngModel)]="item.details.transport"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div
              class="row no-row-margins align-items-center"
              *ngIf="item.amountAdjusted"
            >
              {{ item.subtotalApproved | currency }}
              <span
                class="pl-3p pt-3p pointer"
                [popover]="popTemplate"
                triggers="mouseenter:mouseleave"
                (onShown)="onPopoverShown(item)" (onHidden)="onPopoverHidden()"
                outsideClick="true"
                containerClass="popover-content"
                container="body"
              >
                <i class="material-icons md-20 md-dark">
                  info
                </i>
              </span>
            </div>
            <span class="padding-label-top" *ngIf="!item.amountAdjusted">
              {{ item.subtotal | currency }}
            </span>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="row padding-label-top">
              <button
                [ngClass]="{
                  'icon-button':
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0),
                  'inactive-button':
                    !submitRequests &&
                    (!item.attachments || item.attachments.length == 0),
                  ripple:
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0)
                }"
                [disabled]="
                  (manageRequests || manageProject) &&
                  (!item.attachments || item.attachments.length === 0)
                "
                [matTooltip]="
                  manageRequests ||
                  manageProject ||
                  (item.attachments && item.attachments.length > 0)
                    ? 'View
                Attachments'
                    : 'Add Attachments'
                "
                (click)="viewAttachments(item)"
              >
                <span
                  *ngIf="
                    submitRequests &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  class="badge accent-badge"
                  >+</span
                >
                <span
                  *ngIf="item.attachments && item.attachments.length > 0"
                  class="badge notify-badge"
                  >{{ item.attachments.length }}</span
                >
                <mat-icon
                  [class.disabled]="
                    (manageRequests || manageProject) &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  color="accent"
                  >attach_file</mat-icon
                >
              </button>
              <span *ngIf="submitRequests">
                <button
                  class="ripple icon-button"
                  *ngIf="submitRequests"
                  matTooltip="Remove"
                  (click)="removeLineItem(i, item)"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </span>
              <span *ngIf="manageRequests">
                <button
                  class="ripple icon-button"
                  [disabled]="!manageRequests"
                  matTooltip="Approve
                  With
                  Change"
                  (click)="approveWithChange(i, item)"
                >
                  <mat-icon
                    color="accent"
                    svgIcon="approvewedit"
                    class="approvewedit"
                  ></mat-icon>
                </button>
              </span>
            </div>
          </clr-dg-cell>
          <ng-container
            ngProjectAs="clr-dg-row-detail"
            *ngIf="!draftMode && item && item.details && item.details.modelId"
          >
            <clr-dg-row-detail *clrIfExpanded>
              <div
                *ngIf="item.details.nodata"
                class="px-3 mb-3
                align-content-center align-items-center text-center"
              >
                <h4 class="strong left">No data available for this model</h4>
              </div>
              <div *ngIf="!item.details.nodata">
                <div class="col">
                  <h6 class="strong no-top-margin">Configuration</h6>
                  <table
                    *ngIf="item.details.specsColumns"
                    class="mt-3p table
                    table-compact table-bordered table-striped
                    comparison-table"
                  >
                    <thead>
                      <th
                        class="left"
                        *ngFor="let column of item.details.specsColumns"
                      >
                        {{ column.name }}
                      </th>
                    </thead>
                    <tbody>
                      <tr class="justify-content-center">
                        <td
                          class="left"
                          *ngFor="let column of item.details.specsColumns"
                        >
                          {{ item.details[column.name] }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div
                  class="row col-10 pb-1"
                  *ngIf="manageRequests || manageProject"
                >
                  <div class="col px-1 row-margins">
                    <h6 class="strong left">
                      Rate Verification: Hourly Ownership & Operating Cost
                    </h6>
                    <table
                      id="invoice-table"
                      *ngIf="item.details"
                      class="no-top-margin table
                      table-compact
                      table-bordered table-striped comparison-table"
                    >
                      <thead>
                        <th class="left">Hourly Rate</th>
                        <th class="left">User Supplied</th>
                        <th class="left">Rental Rate Blue Book</th>
                      </thead>
                      <tbody>
                        <tr class="justify-content-center">
                          <td class="strong left">Ownership</td>
                          <td class="left">
                            {{
                              item.details.activeOwnershipAdjustedRate
                                | currency
                            }}
                          </td>
                          <td class="left">
                            {{
                              item.details.activeOwnershipAdjustedRate
                                | currency
                            }}
                          </td>
                        </tr>
                        <tr class="justify-content-center">
                          <td class="strong left">Operating</td>
                          <td class="left">
                            {{
                              item.details.activeOperatingAdjustedRate
                                | currency
                            }}
                          </td>
                          <td class="left">
                            {{
                              item.details.activeOperatingAdjustedRate
                                | currency
                            }}
                          </td>
                        </tr>

                        <tr class="justify-content-center">
                          <td class="strong left">Total</td>
                          <td class="left">
                            {{ item.details.rate | currency }}
                          </td>
                          <td
                            *ngIf="
                              !item.details.rentalConversions ||
                              !item.details.rentalAverages
                            "
                          ></td>
                          <td
                            *ngIf="
                              item.details.rentalConversions &&
                              item.details.rentalAverages
                            "
                            class="left pl-1"
                            style="position:relative"
                            [class.green]="item.details.rentalRateDelta >= 0"
                            [class.red]="item.details.rentalRateDelta < 0"
                          >
                            <mat-icon
                              class="icon rate-icon"
                              style="position:absolute;top:1px;left:4px"
                              *ngIf="item.details.rentalRateDelta >= 0"
                              svgIcon="costtrax-check"
                            ></mat-icon>
                            <mat-icon
                              class="icon rate-icon"
                              style="position:absolute;top:1px;left:4px;font-size:16px"
                              *ngIf="item.details.rentalRateDelta < 0"
                              color="warn"
                              >priority_high</mat-icon
                            >
                            {{ item.details.rentalRetailTotal | currency }}
                            <br />
                            ({{ item.details.rentalRateDelta }} vs User
                            Supplied)
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="row no-row-margins col-10 pb-1">
                  <div class="col-3 row-margins" *ngIf="submitRequests">
                    <h6 class="strong left">
                      Hourly Ownership & Operating Costs
                    </h6>
                    <table
                      *ngIf="item.details"
                      class="mt-3p
                        table table-compact table-bordered table-striped
                        comparison-table"
                    >
                      <thead>
                        <th class="left">Ownership</th>
                        <th class="left">Operating</th>
                        <th class="left">FHWA</th>
                      </thead>
                      <tbody>
                        <tr class="justify-content-center">
                          <td class="left">
                            {{
                              item.details.activeOwnershipAdjustedRate
                                | currency
                            }}
                          </td>
                          <td class="left">
                            {{
                              item.details.activeOperatingAdjustedRate
                                | currency
                            }}
                          </td>
                          <td class="left">
                            {{ item.details.rate | currency }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <h6 class="muted-text no-top-margin" *ngIf="!item.details">
                      Unable to load hourly cost details
                    </h6>
                  </div>

                  <div class="col no-row-margins">
                    <h6 class="strong left">Rate Element Allocation</h6>
                    <h6 class="strong left no-top-margin">
                      Ownership Costs, Unadjusted (Monthly)
                    </h6>
                    <h6 class="muted-text no-top-margin" *ngIf="!item.details">
                      Unable to load ownership cost details
                    </h6>
                    <table
                      *ngIf="item.details"
                      class="no-top-margin table table-compact
                          table-bordered table-striped comparison-table
                          full-width"
                    >
                      <thead>
                        <th class="left">Element</th>
                        <th class="left">Percentage</th>
                        <th class="left">Amount</th>
                      </thead>
                      <tbody>
                        <tr class="justify-content-center">
                          <td class="strong left">Depreciation</td>
                          <td class="left">
                            {{ item.details.depreciationPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.depreciationValue | currency }}
                          </td>
                        </tr>
                        <tr class="justify-content-center">
                          <td class="strong left">Overhaul</td>
                          <td class="left">
                            {{ item.details.overhaulPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.overhaulValue | currency }}
                          </td>
                        </tr>
                        <tr class="justify-content-center">
                          <td class="strong left">
                            Cost of Facilities Capital
                          </td>
                          <td class="left">
                            {{ item.details.cfcPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.cfcValue | currency }}
                          </td>
                        </tr>
                        <tr class="justify-content-center">
                          <td class="strong left">Indirect</td>
                          <td class="left">
                            {{ item.details.overheadValue | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.overheadValue | currency }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="col">
                    <h6 class="strong left">Rate Element Allocation</h6>
                    <h6 class="strong left no-top-margin">
                      Operating Costs, (Hourly)
                    </h6>
                    <h6 class="muted-text no-top-margin" *ngIf="!item.details">
                      Unable to load operating cost details
                    </h6>
                    <table
                      *ngIf="item.details"
                      class="no-top-margin table table-compact
                          table-bordered table-striped comparison-table
                          full-width"
                    >
                      <thead>
                        <th class="left">Element</th>
                        <th class="left">Percentage</th>
                        <th class="left">Amount</th>
                      </thead>
                      <tbody>
                        <tr class="justify-content-center">
                          <td class="left" style="width: 125px">
                            Fuel @
                            {{ item.details.fuelUnitCost | currency }}
                          </td>
                          <td class="left">
                            {{ item.details.fuelPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.fuelValue | currency }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </clr-dg-row-detail>
          </ng-container>
        </clr-dg-row>

        <clr-dg-footer *ngIf="!printingInvoice"
          >{{ itemList.items.length }} Items</clr-dg-footer
        >
      </clr-datagrid>
      <clr-datagrid *ngIf="itemType === 'equipmentStandby' && accountSynced">
        <clr-dg-column
          *ngIf="manageRequests || manageProject"
          style="width:50px"
          >Status
        </clr-dg-column>
        <clr-dg-column
          [clrDgField]="'details.manufacturerName'"
          style="width:200px"
          >Make</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.model'" style="width:150px"
          >Model</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.year'" style="width:75px"
          >Year</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.subSize'" style="width:350px"
          >Subtype & Size Class</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.hours'" style="width:55px"
          >Hours</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.rate'" style="width:150px"
          >Standby Rate</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.transport'" style="width:150px"
          >Transport</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'subtotal'" style="min-width:200px"
          >Total</clr-dg-column
        >
        <clr-dg-column style="min-width: 130px"></clr-dg-column>
        <clr-dg-row
          *clrDgItems="
            let item of itemList.items;
            let i = index;
            trackBy: trackByFn
          "
          [clrDgItem]="item"
        >
          <clr-dg-cell *ngIf="manageRequests || manageProject">
            <div
              *ngIf="(manageRequests || manageProject) && item.rateVerified()"
              class="padding-label-top row"
              style="padding-left:10px"
            >
              <mat-icon svgIcon="costtrax-check"></mat-icon>
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">
              {{ item.details.manufacturerName }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">{{ item.details.model }}</div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="item.misc">N/A</div>
            <div class="padding-label-top" *ngIf="!item.misc">
              {{ item.details.year }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">{{ item.details.subSize }}</div>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="padding-label-top">
              <div *ngIf="!submitRequests">
                {{ item.details.hours | number: '.0-0' }}
              </div>
              <nz-input-number
                *ngIf="submitRequests"
                [(ngModel)]="item.details.hours"
                style="width:65px"
                (ngModelChange)="standbyChanged(item)"
                [nzSize]="'small'"
                [nzMin]="0"
                [nzStep]="1"
              ></nz-input-number>
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="!item.details.nodata" class="padding-label-top">
              {{ item.details.rate | currency }}
            </div>
            <div class="padding-label-top" *ngIf="item.details.nodata">
              no data
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="!submitRequests">
              {{ item.details.transport | currency }}
            </div>
            <div *ngIf="submitRequests" class="padding-label-top">
              <input
                nz-input
                placeholder="Transport"
                nzSize="small"
                currencyMask
                (blur)="standbyChanged(item)"
                style="width:100px"
                (keypress)="standbyChanged(item)"
                [(ngModel)]="item.details.transport"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="row no-row-margins align-items-center" *ngIf="item.amountAdjusted">
              {{ item.subtotalApproved | currency }}
              <span class="pl-3p pt-3p pointer" [popover]="item.popover" outsideClick="true" triggers="mouseenter:mouseleave" (onShown)="onPopoverShown(item)" (onHidden)="onPopoverHidden()" containerClass="popover-content" container="body">
                <i class="material-icons md-20 md-dark">
                  info
                </i>
              </span>
            </div>
            <span class="padding-label-top" *ngIf="!item.amountAdjusted">
              {{ item.subtotal | currency }}
            </span>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="row padding-label-top">
              <button
                [ngClass]="{
                  'icon-button':
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0),
                  'inactive-button':
                    !submitRequests &&
                    (!item.attachments || item.attachments.length == 0),
                  ripple:
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0)
                }"
                [disabled]="
                  (manageRequests || manageProject) &&
                  (!item.attachments || item.attachments.length === 0)
                "
                [matTooltip]="
                  manageRequests ||
                  manageProject ||
                  (item.attachments && item.attachments.length > 0)
                    ? 'View
                    Attachments'
                    : 'Add Attachments'
                "
                (click)="viewAttachments(item)"
              >
                <span
                  *ngIf="
                    submitRequests &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  class="badge
                      accent-badge"
                  >+</span
                >
                <span
                  *ngIf="item.attachments && item.attachments.length > 0"
                  class="badge notify-badge"
                  >{{ item.attachments.length }}</span
                >
                <mat-icon
                  [class.disabled]="
                    (manageRequests || manageProject) &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  color="accent"
                  >attach_file</mat-icon
                >
              </button>
              <span *ngIf="submitRequests">
                <button
                  class="ripple icon-button"
                  matTooltip="Remove"
                  (click)="removeLineItem(i, item)"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </span>
              <span *ngIf="manageRequests">
                <button
                  class="ripple icon-button"
                  [disabled]="!manageRequests"
                  matTooltip="Approve
                      With
                      Change"
                  (click)="approveWithChange(i, item)"
                >
                  <mat-icon
                    color="accent"
                    svgIcon="approvewedit"
                    class="approvewedit"
                  ></mat-icon>
                </button>
              </span>
            </div>
          </clr-dg-cell>

          <ng-container
            ngProjectAs="clr-dg-row-detail"
            *ngIf="!draftMode && item && item.details && item.details.modelId"
          >
            <clr-dg-row-detail *clrIfExpanded>
              <div
                *ngIf="item.details.nodata"
                class="px-3 mb-3
                    align-content-center align-items-center text-center"
              >
                <h4 class="strong left">No data available for this model</h4>
              </div>
              <div *ngIf="!item.details.nodata">
                <div class="col">
                  <h6 class="strong no-top-margin">Configuration</h6>
                  <table
                    *ngIf="item.details.specsColumns"
                    class="mt-3p
                        table table-compact table-bordered table-striped
                        comparison-table"
                  >
                    <thead>
                      <th
                        class="left"
                        *ngFor="let column of item.details.specsColumns"
                      >
                        {{ column.name }}
                      </th>
                    </thead>
                    <tbody>
                      <tr class="justify-content-center">
                        <td
                          class="left"
                          *ngFor="let column of item.details.specsColumns"
                        >
                          {{ item.details[column.name] }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="row no-row-margins col-10 pb-1">
                  <div class="col row-margins" *ngIf="submitRequests">
                    <h6 class="strong left">
                      Hourly Ownership & Operating Costs
                    </h6>
                    <table
                      *ngIf="item.details"
                      class="mt-3p
                          table table-compact table-bordered table-striped
                          comparison-table"
                    >
                      <thead>
                        <th class="left">Ownership</th>
                        <th class="left">Operating</th>
                        <th class="left">Standby (50 of Ownership)</th>
                      </thead>
                      <tbody>
                        <tr class="justify-content-center">
                          <td class="left">
                            {{
                              item.details.standbyOwnershipAdjustedRate
                                | currency
                            }}
                          </td>
                          <td class="left">
                            {{
                              item.details.activeOperatingAdjustedRate
                                | currency
                            }}
                          </td>
                          <td class="left">
                            {{ item.details.rate | currency }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <div class="col">
                    <h6 class="strong left">Rate Element Allocation</h6>
                    <h6 class="strong no-top-margin">
                      Ownership Costs, Unadjusted (Monthly)
                    </h6>
                    <table
                      *ngIf="item.details"
                      class="no-top-margin table table-compact
                            table-bordered table-striped comparison-table
                            full-width"
                    >
                      <thead>
                        <th class="left">Element</th>
                        <th class="left">Percentage</th>
                        <th class="left">Amount</th>
                      </thead>
                      <tbody>
                        <tr class="justify-content-center">
                          <td class="strong left">Depreciation</td>
                          <td class="left">
                            {{ item.details.depreciationPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.depreciationValue | currency }}
                          </td>
                        </tr>
                        <tr class="justify-content-center">
                          <td class="strong left">Overhaul</td>
                          <td class="left">
                            {{ item.details.overhaulPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.overhaulValue | currency }}
                          </td>
                        </tr>
                        <tr class="justify-content-center">
                          <td class="strong left">
                            Cost of Facilities Capital
                          </td>
                          <td class="left">
                            {{ item.details.cfcPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.cfcValue | currency }}
                          </td>
                        </tr>
                        <tr class="justify-content-center">
                          <td class="strong left">Indirect</td>
                          <td class="left">
                            {{ item.details.overhaulPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.overheadValue | currency }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="col">
                    <h6 class="strong left">Rate Element Allocation</h6>
                    <h6 class="strong no-top-margin">
                      Operating Costs, (Hourly)
                    </h6>
                    <table
                      *ngIf="item.details"
                      class="no-top-margin table table-compact
                            table-bordered table-striped comparison-table
                            full-width"
                    >
                      <thead>
                        <th class="left">Element</th>
                        <th class="left">Percentage</th>
                        <th class="left">Amount</th>
                      </thead>
                      <tbody>
                        <tr class="justify-content-center">
                          <td class="left" style="width: 125px">
                            Fuel @
                            {{ item.details.fuelUnitCost | currency }}
                          </td>
                          <td class="left">
                            {{ item.details.fuelPercent | percent }}
                          </td>
                          <td class="left">
                            {{ item.details.fuelValue | currency }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </clr-dg-row-detail>
          </ng-container>
        </clr-dg-row>

        <clr-dg-footer *ngIf="!printingInvoice"
          >{{ itemList.items.length }} Items</clr-dg-footer
        >
      </clr-datagrid>

      <clr-datagrid *ngIf="itemType === 'equipmentRental' && accountSynced">
        <clr-dg-column
          *ngIf="manageRequests || manageProject"
          style="width:50px"
          >Status
        </clr-dg-column>
        <clr-dg-column
          [clrDgField]="'details.manufacturerName'"
          style="width:200px"
          >Make</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.model'" style="width:150px"
          >Model</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.subSize'" style="width:350px"
          >Subtype & Size Class</clr-dg-column
        >
        <clr-dg-column
          [clrDgField]="'details.dateRangeStr'"
          [clrDgSortBy]="dateRangeComparator"
          style="width:250px"
        >
          Rental Dates</clr-dg-column
        >

        <clr-dg-column [clrDgField]="'details.invoice'" style="width:150px"
          >Invoice Amount</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.transport'" style="width:125px"
          >Transport</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.operating'" style="width:125px"
          >Operating</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.hours'" style="width:55px"
          >Hours</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.subtotal'" style="min-width:200px"
          >Total</clr-dg-column
        >
        <clr-dg-column style="min-width: 130px"></clr-dg-column>
        <clr-dg-row
          *clrDgItems="
            let item of itemList.items;
            let i = index;
            trackBy: trackByFn
          "
          [clrDgItem]="item"
        >
          <clr-dg-cell *ngIf="manageRequests || manageProject">
            <div
              *ngIf="manageRequests || manageProject"
              class="padding-label-top row"
              style="padding-left: 10px
                    !important"
            >
              <mat-icon
                class="icon"
                *ngIf="item.rateVerified()"
                svgIcon="costtrax-check"
              ></mat-icon>
              <mat-icon class="icon" *ngIf="!item.rateVerified()" color="warn"
                >priority_high</mat-icon
              >
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">
              {{ item.details.manufacturerName }}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top">{{ item.details.model }}</div>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="padding-label-top">{{ item.details.subSize }}</div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="submitRequests">
              <input
                class="w-85"
                type="text"
                bsDaterangepicker
                [bsConfig]="bsConfig"
                (bsValueChange)="dateRangeChanged(item, $event)"
                [(ngModel)]="item.details.dateRange"
              />
            </div>
            <div class="padding-label-top" *ngIf="!submitRequests">
              {{ item.details.dateRange | dates: 'M/dd/yy' }}
            </div>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="!submitRequests">
              {{ item.details.invoice | currency }}
            </div>
            <div class="padding-label-top" *ngIf="submitRequests">
              <input
                nz-input
                placeholder="Invoice"
                nzSize="small"
                currencyMask
                (blur)="rentalChanged(item)"
                style="width:100px"
                (keypress)="rentalChanged(item)"
                [(ngModel)]="item.details.invoice"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="!submitRequests">
              {{ item.details.transport | currency }}
            </div>
            <div class="padding-label-top" *ngIf="submitRequests">
              <input
                nz-input
                placeholder="Transport"
                nzSize="small"
                currencyMask
                (blur)="rentalChanged(item)"
                style="width:100px"
                (keypress)="rentalChanged(item)"
                [(ngModel)]="item.details.transport"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="padding-label-top" *ngIf="!submitRequests">
              {{ item.details.operating | currency }}
            </div>
            <div class="padding-label-top" *ngIf="submitRequests">
              <input
                nz-input
                placeholder="Operating"
                nzSize="small"
                currencyMask
                (blur)="rentalChanged(item)"
                style="width:100px"
                (keypress)="rentalChanged(item)"
                [(ngModel)]="item.details.operating"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div>
              <div class="padding-label-top" *ngIf="!submitRequests">
                {{ item.details.hours | number: '.0-0' }}
              </div>
              <div class="padding-label-top" *ngIf="submitRequests">
                <nz-input-number
                  *ngIf="submitRequests"
                  [(ngModel)]="item.details.hours"
                  style="width:65px"
                  (ngModelChange)="rentalChanged(item)"
                  [nzSize]="'small'"
                  [nzMin]="0"
                  [nzStep]="1"
                ></nz-input-number>
              </div>
            </div>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="row no-row-margins align-items-center" *ngIf="item.amountAdjusted">
              {{ item.subtotalApproved | currency }}
              <span class="pl-3p pt-3p pointer" [popover]="item.popover" outsideClick="true" triggers="mouseenter:mouseleave" (onShown)="onPopoverShown(item)" (onHidden)="onPopoverHidden()" containerClass="popover-content" container="body">
                <i class="material-icons md-20 md-dark">
                  info
                </i>
              </span>
            </div>
            <span class="padding-label-top" *ngIf="!item.amountAdjusted">
              {{ item.subtotal | currency }}
            </span>
          </clr-dg-cell>

          <clr-dg-cell>
            <div class="row padding-label-top">
              <button
                [ngClass]="{
                  'icon-button':
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0),
                  'inactive-button':
                    !submitRequests &&
                    (!item.attachments || item.attachments.length == 0),
                  ripple:
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0)
                }"
                [disabled]="
                  (manageRequests || manageProject) &&
                  (!item.attachments || item.attachments.length === 0)
                "
                [matTooltip]="
                  manageRequests ||
                  manageProject ||
                  (item.attachments && item.attachments.length > 0)
                    ? 'View
                      Attachments'
                    : 'Add Attachments'
                "
                (click)="viewAttachments(item)"
              >
                <span
                  *ngIf="
                    submitRequests &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  class="badge
                        accent-badge"
                  >+</span
                >
                <span
                  *ngIf="item.attachments && item.attachments.length > 0"
                  class="badge notify-badge"
                  >{{ item.attachments.length }}</span
                >
                <mat-icon
                  [class.disabled]="
                    (manageRequests || manageProject) &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  color="accent"
                  >attach_file</mat-icon
                >
              </button>
              <span *ngIf="submitRequests">
                <button
                  class="ripple icon-button"
                  *ngIf="submitRequests"
                  matTooltip="Remove"
                  (click)="removeLineItem(i, item)"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </span>
              <span *ngIf="manageRequests">
                <button
                  class="ripple icon-button"
                  [disabled]="!manageRequests"
                  matTooltip="Approve
                          With
                          Change"
                  (click)="approveWithChange(i, item)"
                >
                  <mat-icon
                    color="accent"
                    svgIcon="approvewedit"
                    class="approvewedit"
                  ></mat-icon>
                </button>
              </span>
            </div>
          </clr-dg-cell>
          <ng-container
            ngProjectAs="clr-dg-row-detail"
            *ngIf="!draftMode && (manageRequests || manageProject)"
          >
            <clr-dg-row-detail *clrIfExpanded>
              <div class="col-8">
                <h6 class="no-top-margin">Rate Verification: Rental Cost</h6>
                <h6
                  class="muted-text no-top-margin"
                  *ngIf="
                    !item.details.rentalAverages ||
                    !item.details.rentalConversion
                  "
                >
                  Unable to load rental cost details
                </h6>
                <table
                  id="invoice-table"
                  *ngIf="
                    item.details.rentalAverages && item.details.rentalConversion
                  "
                  class="no-top-margin
                          table
                          table-compact
                          table-bordered table-striped comparison-table"
                >
                  <thead>
                    <th class="left">Terms</th>
                    <th class="left">
                      {{ item.details.numDays }} Day Rental,<br />Time
                      Conversion
                    </th>
                    <th class="left">User Supplied,<br />Invoice Amount</th>
                    <th class="left">
                      Rental Rate Blue Book,<br />Ownership Cost
                    </th>
                    <th class="left">
                      Retail Rental,<br />{{
                        item.details.rentalAverages.rateSuurce
                      }}
                      Average
                    </th>
                  </thead>
                  <tbody>
                    <tr class="justify-content-center">
                      <td class="strong left">Monthly Rate</td>
                      <td class="left">
                        {{ item.details.rentalConversion.months }}
                      </td>
                      <td class="left"></td>
                      <td class="left">
                        {{
                          item.details.activeOwnershipAdjustedMonthly | currency
                        }}
                      </td>
                      <td class="left">
                        {{ item.details.rentalAverages.monthlyRate | currency }}
                      </td>
                    </tr>
                    <tr class="justify-content-center">
                      <td class="strong left">Weekly Rate</td>
                      <td class="left">
                        {{ item.details.rentalConversion.weeks }}
                      </td>
                      <td class="left"></td>
                      <td class="left">
                        {{
                          item.details.activeOwnershipAdjustedWeekly | currency
                        }}
                      </td>
                      <td class="left">
                        {{ item.details.rentalAverages.weeklyRate | currency }}
                      </td>
                    </tr>
                    <tr class="justify-content-center">
                      <td class="strong left">Daily Rate</td>
                      <td class="left">
                        {{ item.details.rentalConversion.days }}
                      </td>
                      <td class="left"></td>
                      <td class="left">
                        {{
                          item.details.activeOwnershipAdjustedDaily | currency
                        }}
                      </td>
                      <td class="left">
                        {{ item.details.rentalAverages.dailyRate | currency }}
                      </td>
                    </tr>
                    <tr class="justify-content-center">
                      <td class="strong left">Total Cost</td>
                      <td class="left"></td>
                      <td class="left">
                        {{ item.details.invoice | currency }}
                      </td>
                      <td
                        class="left pl-1"
                        style="position: relative"
                        [class.green]="item.details.rentalOwnershipGreen"
                        [class.red]="item.details.rentalOwnershipRed"
                      >
                        <mat-icon
                          class="icon rate-icon"
                          style="position:absolute;top:1px;left:4px"
                          *ngIf="
                            item.details.rentalOwnershipTotal >=
                            item.details.invoice
                          "
                          svgIcon="costtrax-check"
                        ></mat-icon>
                        <mat-icon
                          class="icon rate-icon"
                          style="position:absolute;top:1px;left:4px;font-size:16px"
                          *ngIf="
                            item.details.rentalOwnershipTotal <
                            item.details.invoice
                          "
                          color="warn"
                          >priority_high</mat-icon
                        >
                        {{ item.details.rentalOwnershipTotal | currency }}
                        <br />
                        ({{ item.details.rentalOwnershipDelta | percent }}
                        <span
                          *ngIf="
                            item.details.invoice <=
                            item.details.rentalOwnershipTotal
                          "
                          >above</span
                        ><span
                          *ngIf="
                            item.details.invoice >
                            item.details.rentalOwnershipTotal
                          "
                          >below</span
                        >&nbsp;Invoice)
                      </td>
                      <td
                        class="left pl-1"
                        style="position: relative"
                        [class.green]="item.details.rentalRetailGreen"
                        [class.red]="item.details.rentalRetailRed"
                      >
                        <mat-icon
                          class="icon rate-icon"
                          style="position:absolute;top:1px;left:4px"
                          *ngIf="
                            item.details.rentalRetailTotal >=
                            item.details.invoice
                          "
                          svgIcon="costtrax-check"
                        ></mat-icon>
                        <mat-icon
                          class="icon rate-icon"
                          style="position:absolute;top:1px;left:4px;font-size:16px"
                          *ngIf="
                            item.details.rentalRetailTotal <
                            item.details.invoice
                          "
                          color="warn"
                          >priority_high</mat-icon
                        >
                        {{ item.details.rentalRetailTotal | currency }}
                        <br />
                        ({{ item.details.rentalRetailDelta | percent }}
                        <span
                          *ngIf="
                            item.details.invoice <=
                            item.details.rentalRetailTotal
                          "
                          >above</span
                        ><span
                          *ngIf="
                            item.details.invoice >
                            item.details.rentalRetailTotal
                          "
                          >below</span
                        >&nbsp;Invoice)
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="col-8 pb-2">
                <h6
                  *ngIf="
                    item.details.rentalHouseRates &&
                    item.details.rentalHouseRates.length > 0
                  "
                >
                  Rate Verification: Local Retail Rates for
                  {{ adjustments.rentalLocation.zipcode }}
                </h6>
                <h6
                  *ngIf="
                    !item.details.rentalHouseRates ||
                    item.details.rentalHouseRates.length === 0
                  "
                  class="pb-1"
                >
                  Rate Verification: No Local Retail Rates available for
                  {{ adjustments.rentalLocation.zipcode }}
                </h6>
                <table
                  *ngIf="
                    item.details.rentalHouseRates &&
                    item.details.rentalHouseRates.length > 0
                  "
                  class="no-top-margin table
                              table-compact table-bordered table-striped
                              comparison-table"
                >
                  <thead>
                    <th>Advertised Rate</th>
                    <th *ngFor="let rate of item.details.rentalHouseRates">
                      {{ rate.participantName }}
                    </th>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Monthly</td>
                      <td *ngFor="let rate of item.details.rentalHouseRates">
                        {{ rate.rentalRates.monthlyRate | currency }}
                      </td>
                    </tr>
                    <tr>
                      <td>Weekly</td>
                      <td *ngFor="let rate of item.details.rentalHouseRates">
                        {{ rate.rentalRates.weeklyRate | currency }}
                      </td>
                    </tr>
                    <tr>
                      <td>Daily</td>
                      <td *ngFor="let rate of item.details.rentalHouseRates">
                        {{ rate.rentalRates.dailyRate | currency }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </clr-dg-row-detail>
          </ng-container>
        </clr-dg-row>

        <clr-dg-footer *ngIf="!printingInvoice"
          >{{ itemList.items.length }} Items</clr-dg-footer
        >
      </clr-datagrid>
      <clr-datagrid *ngIf="itemType === 'material'">
        <clr-dg-column
          [clrDgField]="'details.description'"
          style="min-width:300px"
          >Description</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'details.units'">Units</clr-dg-column>
        <clr-dg-column [clrDgField]="'details.unitCost'"
          >Cost Per Unit</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'subtotal'" style="min-width: 200px">Total</clr-dg-column>
        <clr-dg-column></clr-dg-column>
        <clr-dg-row
          *clrDgItems="
            let item of itemList.items;
            let i = index;
            trackBy: trackByFn
          "
          [clrDgItem]="item"
        >
          <clr-dg-cell>
            <div *ngIf="!submitRequests">{{ item.details.description }}</div>
            <input
              nz-input
              nzSize="small"
              style="width:250px"
              *ngIf="submitRequests"
              class="full-width"
              (change)="materialChanged(item)"
              [(ngModel)]="item.details.description"
              [ngModelOptions]="{ standalone: true }"
            />
          </clr-dg-cell>
          <clr-dg-cell>
            <div>
              <div *ngIf="!submitRequests">{{ item.details.units }}</div>

              <nz-input-number
                [(ngModel)]="item.details.units"
                (ngModelChange)="materialChanged(item)"
                [nzSize]="'small'"
                [nzMin]="0"
                [nzStep]="1"
              ></nz-input-number>
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div>
              <div *ngIf="!submitRequests">
                {{ item.details.unitCost | currency }}
              </div>
              <input
                nz-input
                nzSize="small"
                *ngIf="submitRequests"
                (blur)="materialChanged(item)"
                (keypress)="materialChanged(item)"
                currencyMask
                [(ngModel)]="item.details.unitCost"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div>
                <div class="row no-row-margins align-items-center" *ngIf="!submitRequests && item.amountAdjusted">
                  {{ item.subtotalApproved | currency }}
                  <span class="pl-3p pt-3p pointer" [popover]="item.popover" outsideClick="true" triggers="mouseenter:mouseleave" (onShown)="onPopoverShown(item)" (onHidden)="onPopoverHidden()" containerClass="popover-content" container="body">
                    <i class="material-icons md-20 md-dark">
                      info
                    </i>
                  </span>
                </div>
               
              
              <div *ngIf="!submitRequests && !item.amountAdjusted">{{ item.subtotal | currency }}</div>
              <input
                nz-input
                *ngIf="submitRequests"
                placeholder="Subtotal"
                nzSize="small"
                currencyMask
                (blur)="materialChanged(item)"
                style="width:100px"
                (keypress)="materialChanged(item)"
                [(ngModel)]="item.subtotal"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="row">
              <button
                [ngClass]="{
                  'icon-button':
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0),
                  'inactive-button':
                    !submitRequests &&
                    (!item.attachments || item.attachments.length == 0),
                  ripple:
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0)
                }"
                [disabled]="
                  (manageRequests || manageProject) &&
                  (!item.attachments || item.attachments.length === 0)
                "
                [matTooltip]="
                  manageRequests ||
                  manageProject ||
                  (item.attachments && item.attachments.length > 0)
                    ? 'View Attachments'
                    : 'Add Attachments'
                "
                (click)="viewAttachments(item)"
              >
                <span
                  *ngIf="
                    submitRequests &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  class="badge
                              accent-badge"
                  >+</span
                >
                <span
                  *ngIf="item.attachments && item.attachments.length > 0"
                  class="badge
                              notify-badge"
                  >{{ item.attachments.length }}</span
                >
                <mat-icon
                  [class.disabled]="
                    (manageRequests || manageProject) &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  color="accent"
                  >attach_file</mat-icon
                >
              </button>
              <span *ngIf="submitRequests">
                <button
                  class="ripple icon-button"
                  *ngIf="submitRequests"
                  matTooltip="Remove"
                  (click)="removeLineItem(i, item)"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </span>
              <span *ngIf="manageRequests">
                <button
                  class="ripple icon-button"
                  [disabled]="!manageRequests"
                  matTooltip="Approve
                              With
                              Change"
                  (click)="approveWithChange(i, item)"
                >
                  <mat-icon
                    color="accent"
                    svgIcon="approvewedit"
                    class="approvewedit"
                  ></mat-icon>
                </button>
              </span>
            </div>
          </clr-dg-cell>
        </clr-dg-row>

        <clr-dg-footer *ngIf="!printingInvoice"
          >{{ itemList.items.length }} Items</clr-dg-footer
        >
      </clr-datagrid>
      <clr-datagrid *ngIf="itemType === 'other'">
        <clr-dg-column [clrDgField]="'details.type'" style="min-width:150px"
          >Type</clr-dg-column
        >
        <clr-dg-column
          [clrDgField]="'details.description'"
          style="min-width:300px"
          >Description</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'subtotal'" style="min-width: 200px">Total</clr-dg-column>
        <clr-dg-column></clr-dg-column>
        <clr-dg-row
          *clrDgItems="
            let item of itemList.items;
            let i = index;
            trackBy: trackByFn
          "
          [clrDgItem]="item"
        >
          <clr-dg-cell>
            <div>
              <div *ngIf="!submitRequests">{{ item.details.type }}</div>
              <input
                nz-input
                nzSize="small"
                *ngIf="submitRequests"
                class="full-width"
                (change)="otherChanged(item)"
                [(ngModel)]="item.details.type"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="!submitRequests">{{ item.details.description }}</div>
            <input
              *ngIf="submitRequests"
              nz-input
              nzSize="small"
              class="full-width"
              (change)="otherChanged(item)"
              [(ngModel)]="item.details.description"
              [ngModelOptions]="{ standalone: true }"
            />
          </clr-dg-cell>
          <clr-dg-cell>
            <div>
              <div class="row no-row-margins align-items-center" *ngIf="!submitRequests && item.amountAdjusted">
                {{ item.subtotalApproved | currency }}
                <span class="pl-3p pt-3p pointer" [popover]="item.popover" outsideClick="true" triggers="mouseenter:mouseleave" (onShown)="onPopoverShown(item)" (onHidden)="onPopoverHidden()" containerClass="popover-content" container="body">
                  <i class="material-icons md-20 md-dark">
                    info
                  </i>
                </span>
              </div>
              <div *ngIf="!submitRequests && !item.amountAdjusted">{{ item.subtotal | currency }}</div>
              <input nz-input *ngIf="submitRequests" placeholder="Subtotal" nzSize="small" currencyMask (blur)="otherChanged(item)" style="width:100px"
                (keypress)="otherChanged(item)" [(ngModel)]="item.subtotal" [ngModelOptions]="{ standalone: true }" />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="row">
              <button
                [ngClass]="{
                  'icon-button':
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0),
                  'inactive-button':
                    !submitRequests &&
                    (!item.attachments || item.attachments.length == 0),
                  ripple:
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0)
                }"
                [disabled]="
                  (manageRequests || manageProject) &&
                  (!item.attachments || item.attachments.length === 0)
                "
                [matTooltip]="
                  manageRequests ||
                  manageProject ||
                  (item.attachments && item.attachments.length > 0)
                    ? 'View Attachments'
                    : 'Add Attachments'
                "
                (click)="viewAttachments(item)"
              >
                <span
                  *ngIf="
                    submitRequests &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  class="badge
                              accent-badge"
                  >+</span
                >
                <span
                  *ngIf="item.attachments && item.attachments.length > 0"
                  class="badge
                              notify-badge"
                  >{{ item.attachments.length }}</span
                >
                <mat-icon
                  [class.disabled]="
                    (manageRequests || manageProject) &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  color="accent"
                  >attach_file</mat-icon
                >
              </button>
              <span *ngIf="submitRequests">
                <button
                  class="ripple icon-button"
                  *ngIf="submitRequests"
                  matTooltip="Remove"
                  (click)="removeLineItem(i, item)"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </span>
              <span *ngIf="manageRequests">
                <button
                  class="ripple icon-button"
                  [disabled]="!manageRequests"
                  matTooltip="Approve
                              With
                              Change"
                  (click)="approveWithChange(i, item)"
                >
                  <mat-icon
                    color="accent"
                    svgIcon="approvewedit"
                    class="approvewedit"
                  ></mat-icon>
                </button>
              </span>
            </div>
          </clr-dg-cell>
        </clr-dg-row>

        <clr-dg-footer *ngIf="!printingInvoice"
          >{{ itemList.items.length }} Items</clr-dg-footer
        >
      </clr-datagrid>
      <clr-datagrid *ngIf="itemType === 'subcontractor'">
        <clr-dg-column [clrDgField]="'details.subcontractor'"
          >Subcontractor</clr-dg-column
        >
        <clr-dg-column
          [clrDgField]="'details.description'"
          style="min-width:300px"
          >Description</clr-dg-column
        >
        <clr-dg-column [clrDgField]="'subtotal'" style="min-width:200px">Total</clr-dg-column>
        <clr-dg-column></clr-dg-column>
        <clr-dg-row
          *clrDgItems="
            let item of itemList.items;
            let i = index;
            trackBy: trackByFn
          "
          [clrDgItem]="item"
        >
          <clr-dg-cell>
            <div>
              <div *ngIf="!submitRequests">
                {{ item.details.subcontractor }}
              </div>
              <input
                *ngIf="submitRequests"
                nz-input
                nzSize="small"
                class="full-width"
                (change)="subcontractorChanged(item)"
                [(ngModel)]="item.details.subcontractor"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngIf="!submitRequests">{{ item.details.description }}</div>
            <input
              *ngIf="submitRequests"
              nz-input
              nzSize="small"
              class="full-width"
              (change)="subcontractorChanged(item)"
              [(ngModel)]="item.details.description"
              [ngModelOptions]="{ standalone: true }"
            />
          </clr-dg-cell>
          <clr-dg-cell>
            <div>
                <div class="row no-row-margins align-items-center" *ngIf="!submitRequests && item.amountAdjusted">
                  {{ item.subtotalApproved | currency }}
                  <span class="pl-3p pt-3p pointer" [popover]="item.popover" triggers="mouseenter:mouseleave" outsideClick="true" (onShown)="onPopoverShown(item)" (onHidden)="onPopoverHidden()" containerClass="popover-content" container="body">
                    <i class="material-icons md-20 md-dark">
                      info
                    </i>
                  </span>
                </div>
               
              
              <div *ngIf="!submitRequests && !item.amountAdjusted">{{ item.subtotal | currency }}</div>
              <input
                nz-input
                *ngIf="submitRequests"
                placeholder="Subtotal"
                nzSize="small"
                currencyMask
                (blur)="subcontractorChanged(item)"
                style="width:100px"
                (keypress)="subcontractorChanged(item)"
                [(ngModel)]="item.subtotal"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div class="row">
              <button
                [ngClass]="{
                  'icon-button':
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0),
                  'inactive-button':
                    !submitRequests &&
                    (!item.attachments || item.attachments.length == 0),
                  ripple:
                    submitRequests ||
                    (item.attachments && item.attachments.length > 0)
                }"
                [disabled]="
                  (manageRequests || manageProject) &&
                  (!item.attachments || item.attachments.length === 0)
                "
                [matTooltip]="
                  manageRequests ||
                  manageProject ||
                  (item.attachments && item.attachments.length > 0)
                    ? 'View Attachments'
                    : 'Add Attachments'
                "
                (click)="viewAttachments(item)"
              >
                <span
                  *ngIf="
                    submitRequests &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  class="badge
                              accent-badge"
                  >+</span
                >
                <span
                  *ngIf="item.attachments && item.attachments.length > 0"
                  class="badge
                              notify-badge"
                  >{{ item.attachments.length }}</span
                >
                <mat-icon
                  [class.disabled]="
                    (manageRequests || manageProject) &&
                    (!item.attachments || item.attachments.length === 0)
                  "
                  color="accent"
                  >attach_file</mat-icon
                >
              </button>
              <span *ngIf="submitRequests">
                <button
                  class="ripple icon-button"
                  *ngIf="submitRequests"
                  matTooltip="Remove"
                  (click)="removeLineItem(i, item)"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </span>
              <span *ngIf="manageRequests">
                <button
                  class="ripple icon-button"
                  [disabled]="!manageRequests"
                  matTooltip="Approve
                              With
                              Change"
                  (click)="approveWithChange(i, item)"
                >
                  <mat-icon
                    color="accent"
                    svgIcon="approvewedit"
                    class="approvewedit"
                  ></mat-icon>
                </button>
              </span>
            </div>
          </clr-dg-cell>
        </clr-dg-row>

        <clr-dg-footer *ngIf="!printingInvoice"
          >{{ itemList.items.length }} Items</clr-dg-footer
        >
      </clr-datagrid>
    </div>
  </div>
</div>
